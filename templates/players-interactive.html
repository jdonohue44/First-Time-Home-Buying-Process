{% extends "base.html" %}

{% block content %}
<div class="title">Match the Descriptions to Key Players</div>

<div class="row">
  <div class="col-3"></div>
  <div class="col-6">
    <hr>
  </div>
  <div class="col-3"></div>
</div>

<div class="container-fluid mt-2" style="padding: 0 4em;">
  <div class="row g-0">
    <!-- LEFT SIDE -->
    <div class="col-12 col-md-8 d-flex justify-content-center">
      <div class="row g-3">
        <div class="col-6 d-flex justify-content-center">
          <div class="player-card">
            <img src="{{ url_for('static', filename='img/agent.png') }}" class="player-img">
            <div class="dropzone" data-correct="agent">Drag Here</div>
          </div>
        </div>
        <div class="col-6 d-flex justify-content-center">
          <div class="player-card">
            <img src="{{ url_for('static', filename='img/seller.png') }}" class="player-img">
            <div class="dropzone" data-correct="seller">Drag Here</div>
          </div>
        </div>
        <div class="col-6 d-flex justify-content-center mt-4">
          <div class="player-card">
            <img src="{{ url_for('static', filename='img/buyer.png') }}" class="player-img">
            <div class="dropzone" data-correct="buyer">Drag Here</div>
          </div>
        </div>
        <div class="col-6 d-flex justify-content-center mt-4">
          <div class="player-card">
            <img src="{{ url_for('static', filename='img/lawyer.png') }}" class="player-img">
            <div class="dropzone" data-correct="lawyer">Drag Here</div>
          </div>
        </div>
      </div>
    </div>

    <!-- RIGHT SIDE: Descriptions -->
    <div class="col-12 col-md-4 d-flex justify-content-center align-items-center">
      <div id="descriptions" class="row g-2" style="max-width: 500px;">
        <div class="col-6 d-flex flex-column gap-2">
          <div class="draggable-desc" data-role="seller">
            The current homeowner listing the property for sale.
          </div>
          <div class="draggable-desc" data-role="buyer">
            The individual seeking to purchase a home.
          </div>
        </div>
        <div class="col-6 d-flex flex-column gap-2">
          <div class="draggable-desc" data-role="agent">
            A licensed professional who helps through the home-buying process.
          </div>
          <div class="draggable-desc" data-role="lawyer">
            A legal expert who ensures the contract comply laws and resolves disputes.
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="d-flex justify-content-between mt-5 mb-5 align-items-center">
    <a href="{{ url_for('players') }}">
      <img src="{{ url_for('static', filename='img/left-arrow.png') }}" alt="Previous" style="height: 60px;">
    </a>
    <div class="d-flex gap-2">
      <button id="resetButton" class="btn btn-lg btn-warning">Reset</button>
      <button id="checkButton" class="btn btn-lg btn-success" disabled>Check Answers</button>
    </div>       
    <a href="{{ url_for('start_learning') }}">
      <img src="{{ url_for('static', filename='img/right-arrow.png') }}" alt="Next" style="height: 60px;">
    </a>
  </div>

</div>

{% endblock %}

{% block scripts %}
<script>
  $(function () {
    $(".draggable-desc").draggable({
      revert: "invalid",
      helper: "clone"
    });

    $(".dropzone").droppable({
      accept: ".draggable-desc",
      over: function (event, ui) {
        $(this).addClass("active-hover");
      },
      out: function (event, ui) {
        $(this).removeClass("active-hover");
      },
      drop: function (event, ui) {
        var dropped = $(ui.draggable).clone();
        $(this).html(dropped).removeClass("correct incorrect active-hover").addClass("dropped");

        // New line: remove the original from the list
        $(ui.draggable).remove();

        checkIfAllDropped();
      }
    });


    function checkIfAllDropped() {
      let allFilled = true;
      $(".dropzone").each(function () {
        if ($(this).children().length === 0) {
          allFilled = false;
        }
      });
      $("#checkButton").prop("disabled", !allFilled);
    }

    $("#checkButton").click(function () {
      $(".dropzone").each(function () {
        var correctRole = $(this).attr("data-correct");
        var droppedRole = $(this).find(".draggable-desc").attr("data-role");

        if (correctRole === droppedRole) {
          $(this).removeClass("incorrect").addClass("correct");
        } else {
          $(this).removeClass("correct").addClass("incorrect");
        }
      });
    });

    $("#resetButton").click(function () {
      $(".dropzone").html("Drag Here").removeClass("correct incorrect dropped");
      $("#descriptions").html(`
        <div class="col-6 d-flex flex-column gap-2">
          <div class="draggable-desc" data-role="seller">
            The current homeowner listing the property for sale.
          </div>
          <div class="draggable-desc" data-role="buyer">
            The individual seeking to purchase a home.
          </div>
        </div>
        <div class="col-6 d-flex flex-column gap-2">
          <div class="draggable-desc" data-role="agent">
            A licensed professional who helps through the home-buying process.
          </div>
          <div class="draggable-desc" data-role="lawyer">
            A legal expert who ensures the contract comply laws and resolves disputes.
          </div>
        </div>
      `);
      initDrag();
      $("#checkButton").prop("disabled", true);
    });

    function initDrag() {
      $(".draggable-desc").draggable({
        revert: "invalid",
        helper: "clone"
      });
    }
  });
</script>
{% endblock %}